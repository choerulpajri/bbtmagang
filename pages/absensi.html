<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Absensi Kehadiran</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; max-width: 480px; margin: 20px auto; padding: 10px; }
    input, button { padding: 10px; width: 100%; margin: 5px 0; }
    button { cursor: pointer; background: #4CAF50; color: white; border: none; border-radius: 5px; }
    #status { margin-top: 10px; font-weight: bold; }
    #debug { font-size: 14px; color: #555; margin-top: 8px; white-space: pre-line; }
  </style>
</head>
<body>
  <h2>Absensi Kehadiran</h2>
  <input id="nama" placeholder="Masukkan Nama" />
  <button onclick="absen()">Absen Sekarang</button>
  <p id="status"></p>
  <div id="debug"></div>

  <script>
    function absen() {
      const nama = document.getElementById("nama").value.trim();
      const statusEl = document.getElementById("status");
      const debugEl = document.getElementById("debug");
      statusEl.textContent = "⏳ Mengambil lokasi...";

      if (!nama) {
        alert("Isi nama dulu!");
        return;
      }

      if (!navigator.geolocation) {
        alert("Browser tidak mendukung GPS");
        return;
      }

      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const { latitude, longitude, accuracy } = pos.coords;
          const waktu = new Date().toLocaleString();

          debugEl.textContent =
            `Lat: ${latitude}\nLon: ${longitude}\nAccuracy: ±${Math.round(accuracy)} m\nWaktu: ${waktu}`;

          google.script.run
            .withSuccessHandler((res) => { statusEl.textContent = res; })
            .withFailureHandler((err) => { statusEl.textContent = "❌ Gagal: " + err; })
            .doPost({
              postData: { contents: JSON.stringify({ nama, latitude, longitude, waktu }) }
            });
        },
        (err) => {
          statusEl.textContent = "❌ GPS error: " + err.message;
        },
        { enableHighAccuracy: true, timeout: 15000, maximumAge: 0 }
      );
    }
  </script>
</body>
</html>
